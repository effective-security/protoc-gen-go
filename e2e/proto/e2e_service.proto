syntax = "proto3";

package e2e;
option go_package = "github.com/effective-security/protoc-gen-go/e2e";

import "e2e.proto";
import "google/protobuf/empty.proto";
import "es/api/annotations.proto";

// E2E service provides a test
service E2E {
    // Hello returns a Basic
    rpc Hello(Basic) returns (Basic) {}

    // HelloStream returns a stream of Basic
    rpc HelloStream(Basic) returns (stream Basic) {}

    // Goodbuy returns a Nested
    rpc Goodbuy(google.protobuf.Empty) returns (Nested) {}

    // GetAnnotation returns an item
    rpc GetAnnotation(AnnotationRequest) returns (Annotation) {
        option (es.api.allowed_roles) = "User";
        option (es.api.cli_cmd)       = "e2e annotation get";
    }

    // ListAnnotations returns a list
    rpc ListAnnotations(ListAnnotationsRequest) returns (AnnotationsResponse) {
        option (es.api.allowed_roles) = "User";
        option (es.api.cli_cmd)       = "e2e annotation list";
    }

    rpc UpdateAnnotation(Annotation) returns (Annotation) {
        option (es.api.allowed_roles) = "User";
        option (es.api.cli_cmd)       = "e2e annotation update";
    }
}

// KVPair provides generic key-value pair
message KVPair {
    option (es.api.generate_meta) = true;

    // Key is a key of the pair
    string Key = 1 [
        json_name         = "Key",
        (es.api.search)   = "keyword,facet,store",
        (es.api.required) = true
    ];
    // Value is a value of the pair
    string Value = 2 [
        json_name         = "Value",
        (es.api.search)   = "keyword,store,hide",
        (es.api.required) = true
    ];
}

message Annotation {
    string ID = 1 [
        json_name         = "ID",
        (es.api.required) = true,
        (es.api.min)      = 9,
        (es.api.max)      = 19
    ];

    string Name = 2 [json_name = "Name", (es.api.min) = 2, (es.api.max) = 12];
    AnnotationType.Enum Type = 3 [json_name = "Type", (es.api.required) = true];

    map<string, string> Map = 4 [
        json_name          = "Map",
        (es.api.min_count) = 1,
        (es.api.max_count) = 3,
        (es.api.list)      = "skip"
    ];

    // Metadata is a list of internal metadata associated with the asset
    repeated KVPair Metadata = 5 [
        json_name         = "Metadata",
        (es.api.required) = true,
        (es.api.list)     = "skip"
    ];

    Basic Basic = 6
        [json_name = "Basic", (es.api.required) = true, (es.api.list) = "skip"];

    float FloatValue = 7 [
        json_name         = "FloatValue",
        (es.api.required) = true,
        (es.api.min)      = 1,
        (es.api.max)      = 3
    ];

    bytes BytesValue = 8 [
        json_name         = "BytesValue",
        (es.api.required) = true,
        (es.api.min)      = 2,
        (es.api.max)      = 10
    ];

    uint64 Uint64Value = 9 [
        json_name         = "Uint64Value",
        (es.api.required) = true,
        (es.api.min)      = 1,
        (es.api.max)      = 10
    ];

    int64 Int64Value = 10 [
        json_name         = "Int64Value",
        (es.api.required) = true,
        (es.api.min)      = 1,
        (es.api.max)      = 10
    ];

    uint32 Uint32Value = 11 [
        json_name         = "Uint32Value",
        (es.api.required) = true,
        (es.api.min)      = 2,
        (es.api.max)      = 10
    ];

    int32 Int32Value = 12 [
        json_name         = "Int32Value",
        (es.api.required) = true,
        (es.api.min)      = 2,
        (es.api.max)      = 10
    ];
}

message AnnotationRequest {
    string ID = 1 [
        json_name         = "ID",
        (es.api.required) = true,
        (es.api.min)      = 9,
        (es.api.max)      = 19
    ];
}

message ListAnnotationsRequest {
    string Name = 1 [
        json_name         = "Name",
        (es.api.required) = true,
        (es.api.min)      = 4,
        (es.api.max)      = 64
    ];

    string AssetID = 2 [
        json_name            = "AssetID",
        (es.api.required_or) = "ResourceID",
        (es.api.max)         = 19
    ];

    string ResourceID = 3 [
        json_name            = "ResourceID",
        (es.api.required_or) = "AssetID",
        (es.api.max)         = 19
    ];

    repeated string AssetIDs = 4 [
        json_name          = "AssetIDs",
        (es.api.min_count) = 1,
        (es.api.max_count) = 3
    ];

    AnnotationType.Enum Type = 5 [json_name = "Type"];

    uint32 Offset = 6 [json_name = "Offset", (es.api.max) = 1000];
    uint32 Limit  = 7 [json_name = "Limit", (es.api.max) = 1000];

    string Display = 8
        [json_name = "Display", (es.api.min) = 9, (es.api.max) = 19];
}

message AnnotationsResponse {
    option (es.api.list_sources) = "Annotations";

    repeated Annotation Annotations = 1 [json_name = "Annotations"];
    uint32 NextOffset               = 2 [json_name = "NextOffset"];
}

message AnnotationType {
    // JobType define Job type constants
    enum Enum {
        option (es.api.is_bitmask) = true;

        Unknown = 0;
        Bar     = 1;
        Foo     = 2;
    }
}